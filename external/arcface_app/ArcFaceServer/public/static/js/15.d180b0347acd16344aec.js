webpackJsonp([15],{GEc7:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("Gu7T"),o=s.n(i),a={data:function(){return{flag:!1,fileList:[]}},mounted:function(){},computed:{tipLabel:function(){return this.$t("systemUpgrade.tipLabel")}},methods:{handleRemove:function(t){var e=this.fileList.indexOf(t),s=this.fileList.slice();s.splice(e,1),this.fileList=s},beforeUpload:function(t,e){return this.fileList=[].concat(o()(this.fileList),[t]),console.log(t),console.log(t.name),t.type.includes("zip")||(this.fileList=[],this.$message.error(this.$t("management.onlyZip"))),!1},handleUpload:function(){var t=this;this.flag=!0;var e=new FormData;e.append("package",this.fileList[0]),e.append("packageSize",this.fileList[0].size),this.formData=e,this.$axios.post("updateFirmware",e,{timeout:8e6}).then(function(e){0===e.data.retCode?(console.log(e.data),t.flag=!1,t.$message.success(t.$t("systemUpgrade.upok"))):1100===e.data.info.code?t.$message.error(t.$t("systemUpgrade.upretok")):(t.$message.destroy(),t.$message.error(t.$t("systemUpgrade.uperror")))})},getwebsocketInfo:function(){var t=this;this.$axios.get("/getWebSocketInfo").then(function(e){t.port=e.data.info.ip+":"+e.data.info.port,t.initWebSocket(t.port,t.formData)})},initWebSocket:function(t){var e="ws://"+t;this.$store.dispatch("setSocketPort",t),this.websock=new WebSocket(e),this.websock.onmessage=this.websocketonmessage,this.websock.onopen=this.websocketonopen,this.websock.onerror=this.websocketonerror,this.websock.onclose=this.websocketclose},websocketonopen:function(){},websocketonerror:function(){this.initWebSocket(this.port)},websocketonmessage:function(t){var e=JSON.parse(t.data);console.log(e)},websocketsend:function(t){this.websock.send(t)},websocketclose:function(t){console.log("断开连接",t)}}},n={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.flag?s("a-spin",{attrs:{tip:t.tipLabel}},[s("div",{staticClass:"clearfix"},[s("div",{staticStyle:{width:"350px"}},[s("span",{staticStyle:{"margin-left":"15px"}},[t._v(t._s(t.$t("systemUpgrade.systemup")))]),t._v(" "),s("a-upload",{attrs:{accept:".zip","file-list":t.fileList,remove:t.handleRemove,"before-upload":t.beforeUpload}},[s("a-button",{staticStyle:{width:"180px","margin-top":"30px","margin-left":"30px"}},[s("a-icon",{attrs:{type:"upload"}}),t._v(" "),t._v("\r\n        "+t._s(t.$t("systemUpgrade.importfile"))+"\r\n        ")],1)],1)],1),t._v(" "),s("span",[s("a-button",{staticStyle:{"margin-top":"30px","margin-left":"15px"},attrs:{ghost:"",type:"primary"},on:{click:t.handleUpload}},[t._v("\r\n       "+t._s(t.$t("systemUpgrade.upgrade"))+"\r\n      ")])],1)])]):s("div",[s("div",{staticClass:"clearfix"},[s("div",{staticStyle:{width:"350px"}},[s("span",{staticStyle:{"margin-left":"15px"}},[t._v(t._s(t.$t("systemUpgrade.systemup")))]),t._v(" "),s("a-upload",{attrs:{accept:".zip","file-list":t.fileList,remove:t.handleRemove,"before-upload":t.beforeUpload}},[s("a-button",{staticStyle:{width:"180px","margin-top":"30px","margin-left":"30px"}},[s("a-icon",{attrs:{type:"upload"}}),t._v(" "),t._v("\r\n        "+t._s(t.$t("systemUpgrade.importfile"))+"\r\n        ")],1)],1)],1),t._v(" "),s("span",[s("a-button",{staticStyle:{"margin-top":"30px","margin-left":"15px",color:"white"},attrs:{disabled:0===t.fileList.length,type:"primary"},on:{click:t.handleUpload}},[t._v("\r\n        "+t._s(t.$t("systemUpgrade.upgrade"))+"\r\n      ")])],1)])])},staticRenderFns:[]};var r=s("VU/8")(a,n,!1,function(t){s("GfHD")},"data-v-a25861d2",null);e.default=r.exports},GfHD:function(t,e){}});